version: "3.7"
services:
    nginx:
        build:
            context: ./docker/development/nginx
        volumes:
            -  ./:/var/www
        ports:
            -   "8080:80"
        depends_on:
            -   php-fpm
    php-fpm:
        build:
            context: ./docker/development/php-fpm
        volumes:
            -  ./:/var/www
        depends_on:
            -  mysql
            -  redis
        environment:
            - "DB_PORT=3306"
            - "DB_HOST=mysql"
            - "REDIS_PORT=6379"
            - "REDIS_HOST=redis"
    php-cli:
        build:
            context: ./docker/development/php-cli
        volumes:
            - ./:/var/www
        depends_on:
            - mysql
            - redis
        environment:
            - "DB_PORT=3306"
            - "DB_HOST=mysql"
            - "REDIS_PORT=6379"
            - "REDIS_HOST=redis"
        tty: true
    mysql:
        image: mysql:8
        volumes:
            -   ./storage/docker/mysql:/var/lib/mysql
        environment:
            MYSQL_DATABASE: ${DB_DATABASE}
            MYSQL_USER: ${DB_USERNAME}
            MYSQL_PASSWORD: ${DB_PASSWORD}
            MYSQL_ROOT_PASSWORD: secret
        ports:
            -   "3306:3306"
    redis:
        image: redis:6.2.5
        ports:
            -   "6379:6379"
    node:
        build:
            context: ./docker/development/node
        volumes:
            - ./:/var/www
        tty: true

